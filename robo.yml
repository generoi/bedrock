machine_name: <example-project>
organization: generoi
theme_path: 'web/app/themes/wp-gds-theme'
placeholders:
  '%files': web/app/uploads/
env:
  '@docker':
    host: '${machine_name}.ddev.local'
    wpcli: 'ddev exec wp-cli'
    path: /var/www/html
    url: 'http://${machine_name}.ddev.local'
  '@dev':
    host: '${machine_name}.test'
    user: vagrant
    path: /var/www/wordpress
    url: 'http://${machine_name}.test'
  '@staging':
    host: minasithil.genero.fi
    user: deploy
    path: '/var/www/staging/${machine_name}/current'
    ssh: 'ssh -o ForwardAgent=yes'
    url: 'http://${machine_name}.web.staging.minasithil.genero.fi'
  '@production':
    host: '${machine_name}.fi'
    user: deploy
    path: '/home/www/${machine_name}/deploy/current'
    url: 'https://${machine_name}.fi'
    # Use a custom port:
    #   port: 22
    #   ssh: 'ssh -p 50860'
command:
  build:
    production:
      options:
        npm-script: 'build:production'
    development:
      options:
        npm-script: build
  deploy:
    options:
      uri: ${organization}/${machine_name}
    production:
      options:
        workflow: deploy_production.yml
    staging:
      options:
        workflow: deploy_staging.yml
  setup:
    options:
      theme-repository: false
      theme-branch: false
      no-commit: false
  search:
    replace:
      options:
        dirs:
          - config
          - web/app/themes
          - web/app/mu-plugins
        exclude:
          - robo.yml
          - dist
  db:
    options:
      exclude_tables:
        - wp_gf_entry
        - wp_gf_entry_meta
        - wp_gf_entry_notes
        - wp_gf_incomplete_submissions
        - wp_rg_incomplete_submissions
        - wp_rg_lead
        - wp_rg_lead_detail
        - wp_rg_lead_detail_long
        - wp_rg_lead_meta
        - wp_rg_lead_notes
        - wp_stream
        - wp_stream_meta
    pull:
      options:
        target: '@dev'
    push:
      options:
        source: '@dev'
  files:
    options:
      options:
        chmod: 'Dug=rwx,Do=rx,Fug=rw,Fo=r'
      exclude:
        - gravity_forms/
        - '*.webp'
        - '*-c-*.jpg'
        - '*-c-*.jpeg'
        - '*-c-*.png'
task:
  Remote:
    RsyncAlias:
      settings:
        progress: true
        humanReadable: true
  Wp:
    WpCliStack:
      settings:
        executable: ./vendor/bin/wp
